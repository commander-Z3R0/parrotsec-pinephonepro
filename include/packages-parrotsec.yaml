{{- $architecture := or .architecture "arm64" -}}

architecture: {{ $architecture }}

actions:
  - action: apt
    description: Install Parrot base dependencies
    recommends: false
    packages:
      - ca-certificates
      - wget
      - gnupg
      - apt-transport-https

  - action: overlay
    description: Copy Parrot APT configuration
    source: parrot-script/config/system/
    destination: /opt/parrot-config/

  - action: overlay
    description: Copy Parrot core minimal installer
    source: parrot-core-minimal.sh
    destination: /usr/local/bin/parrot-core-minimal.sh

  - action: run
    description: Install Parrot Core
    chroot: true
    environment:
      DEBIAN_FRONTEND: noninteractive
    command: |
      chmod +x /usr/local/bin/parrot-core-minimal.sh
      /usr/local/bin/parrot-core-minimal.sh
